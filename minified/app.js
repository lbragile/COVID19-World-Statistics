var $link=$("a"),$paths=$("path"),$info_box=$(".info-box li"),$input=$("#scaling"),$continents=$(".continents"),colors=["#FF0000","#FF6666","#FF8000","#FFB266","#FFFF00","#FFFF66","#80FF00","#B2FF66","#FFF"],text=["≤100% <br><br> >87.5%","≤87.5% <br><br> >75.0%","≤75.0% <br><br> >62.5%","≤62.5% <br><br> >50.0%","≤50.0% <br><br> >37.5%","≤37.5% <br><br> >25.0%","≤25.0% <br><br> >12.5%","≤12.5% <br><br> ≥0.00%"],exclude_countries=["Chile","Haiti","Mozambique","Cambodia","Malawi","Burundi","Uganda","Benin","Portugal","Côte d'Ivoire","Netherlands","Czechia","Belgium","Rwanda","Germany","Greece","Libyan Arab Jamahiriya","Vanuatu"],include_countries=["Greenland","Mongolia","Fiji","New Zealand","Papua New Guinea","Uruguay","Paraguay","Namibia","Iceland","Norway"],allowed_values=["cases","deaths","recovered","todayCases","todayDeaths","todayRecovered","active","critical","affectedCountries","population","updated"],pan_zoom_settings={panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,mouseWheelZoomEnabled:!0,preventMouseEventsDefault:!0,zoomScaleSensitivity:.2,minZoom:.2,maxZoom:5,fit:!0,contain:!1,center:!0,refreshRate:"auto"};function numberWithCommas(e){if(null!=e)return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function convertStringToDateTime(e){return new Date(e).toLocaleString("en-US",{timeZone:"America/Vancouver"})}function getIndex(e,t){return e.findIndex(function(e){return e.countryInfo.iso2==t})}function addText(e){$.each($paths,(t,a)=>{let o=a.getAttribute("id");if(2==o.length&&(index=getIndex(e,o)),e[index].population>1e7&&!exclude_countries.includes(e[index].country)||include_countries.includes(e[index].country)){let e=$paths[t],a=document.createElementNS("http://www.w3.org/2000/svg","text"),o=e.getBBox();o.width>0&&(a.setAttribute("transform","translate("+(o.x+o.width/2)+" "+(o.y+o.height/2)+")"),a.textContent=e.getAttribute("data-name"),a.setAttribute("id","text-"+e.getAttribute("id")),e.parentNode.insertBefore(a,e.nextSibling))}})}function statisticHeatMap(e){$.each($(".options").find("input"),(t,a)=>{if($(a).is(":checked")){var o=[];$.each(e,function(e,t){"cases"==a.id?o.push(t.todayCases):"deaths"==a.id?o.push(t.todayDeaths):o.push(t.todayRecovered)});var i=o.reduce(function(e,t){return e+t},0)/o.length,n=Math.max(...o),s=Math.min(...o),l=(i+n)/2,r=(l+n)/2,c=(i+l)/2,d=(s+i)/2,u=(i+d)/2,h=(s+d)/2;$.each($paths,function(t,a){let n=getIndex(e,a.getAttribute("id"));o[n]>r?a.style.fill=colors[0]:o[n]>l?a.style.fill=colors[1]:o[n]>c?a.style.fill=colors[2]:o[n]>i?a.style.fill=colors[3]:o[n]>u?a.style.fill=colors[4]:o[n]>d?a.style.fill=colors[5]:o[n]>h?a.style.fill=colors[6]:a.style.fill=colors[7]})}})}function addTableRow(e){var t,a=Object.values(e);t=/\d/.test(a[0])?"<td>Global</td><br/>":`<td>${a[0]}</td><br/>`,a.forEach((e,a)=>{a>0&&a<=8&&(t+=`<td> ${numberWithCommas(e)} </td><br/>`)});let o=a[13];for(let e=1;e<=9;e+=2)9==e&&e--,t+=`<td> ${numberWithCommas((1e6*a[e]/o).toFixed(2))} </td><br/>`;t=`<tr> ${t+=`<td> ${numberWithCommas(o)} </td><br/>`} </tr>`,$(".table-info tbody").append(t)}function displayContinents(e){var t=[],a=[];$.each($continents.children().find("input"),(e,a)=>{$(a).is(":checked")&&t.push($(a).attr("name"))}),$.each(e,(e,o)=>{t.includes(o.continent)&&a.push(o.countryInfo.iso2)}),$.each($paths,(e,t)=>{a.includes(t.id)?($(t).show(),$(`#text-${t.id}`).show()):($(t).hide(),$(`#text-${t.id}`).hide())});var o={updated:0,cases:0,todayCases:0,deaths:0,todayDeaths:0,recovered:0,todayRecovered:0,active:0,critical:0,casesPerOneMillion:0,deathsPerOneMillion:0,tests:0,testsPerOneMillion:0,population:0,oneCasePerPeople:0,oneDeathPerPeople:0,oneTestPerPeople:0,activePerOneMillion:0,recoveredPerOneMillion:0,criticalPerOneMillion:0,affectedCountries:213};$.each(e,(e,a)=>{t.includes(a.continent)&&$.each(o,e=>{allowed_values.includes(e)&&(o[e]+=a[e])})}),o.affectedCountries=a.length,o.updated=$("#update-time span").html(),$("#svg-map text").hide(),$("#country-switch").is(":checked")&&addText(e),displayGlobalStatistics(o)}function displayGlobalStatistics(e){215==e.affectedCountries&&(e.affectedCountries=213);for(let t in allowed_values)t<allowed_values.length-1?(html_val=numberWithCommas(e[allowed_values[t]]),$(".global-info").find("span").eq(t).html(html_val)):(html_val=convertStringToDateTime(e[allowed_values[t]]),$("#update-time span").html(html_val));$('#DataTables_Table_0_wrapper td:contains("Global")').length||addTableRow(e)}function plotHistory(e,t,a){plotData(e,a,0),a&&$(document).on("click touchstart","path",function(){try{$(this).animate({opacity:.25,"stroke-width":"10px"},2e3,"linear"),$(this).animate({opacity:1,"stroke-width":"1px"},1e3,"linear");let o=t.indexOf($(this).attr("data-name"));plotData(e,a,o),$(".table-position input").val($(this).attr("data-name")).trigger("keyup.DT")}catch{alert(`${$(this).attr("data-name")} doesn't have any historical data`)}})}function plotData(e,t,a){let o={x:t?Object.keys(e[a].timeline.cases):Object.keys(e.cases),y:t?Object.values(e[a].timeline.cases):Object.values(e.cases),type:"scatter",name:"cases"},i={x:t?Object.keys(e[a].timeline.deaths):Object.keys(e.deaths),y:t?Object.values(e[a].timeline.deaths):Object.values(e.deaths),type:"scatter",name:"deaths"},n={x:t?Object.keys(e[a].timeline.recovered):Object.keys(e.recovered),y:t?Object.values(e[a].timeline.recovered):Object.values(e.recovered),type:"scatter",name:"recovered"},s={title:{text:t?`<b>${e[a].country}</b>`:"<b>Global</br>",font:{family:"Times New Roman, monospace",size:24},xref:"paper",x:.5},xaxis:{title:{text:"<b>Date</b>",font:{family:"Times New Roman, monospace",size:18}}},yaxis:{title:{text:"<b>Number of Occurances</b>",font:{family:"Times New Roman, monospace",size:18}}},legend:{x:window.innerWidth>600?.25:.05,y:1.1,orientation:"h"},width:window.innerWidth>=993?.4*window.innerWidth-15:window.innerWidth-20,margin:{r:20,l:65}},l=[o,i,n],r=t?"local_graph":"global_graph";Plotly.newPlot(r,l,s,{responsive:!0})}function displayStatsPerCountry(e){e.splice(55,1),e.splice(116,1),addText(e),$("#country-switch").on("change",function(){$(this).is(":checked")?addText(e):$("#svg-map text").hide()}),statisticHeatMap(e),$.each(e,(e,t)=>{addTableRow({updated:t.country,cases:t.cases,todayCases:t.todayCases,deaths:t.deaths,todayDeaths:t.todayDeaths,recovered:t.recovered,todayRecovered:t.todayRecovered,active:t.active,critical:t.critical,casesPerOneMillion:0,deathsPerOneMillion:0,tests:0,testsPerOneMillion:0,population:t.population,oneCasePerPeople:0,oneDeathPerPeople:0,oneTestPerPeople:0,activePerOneMillion:0,recoveredPerOneMillion:0,criticalPerOneMillion:0,affectedCountries:213})}),$(".table-info").DataTable({pageLength:10,scrollX:!0}),$link.on("mouseenter touchstart mousemove touchmove mouseleave touchend",function(t){let a=$(this).children().first("path"),o=getIndex(e,a.attr("id"));if(-1!=o)if("mouseenter"==t.type||"touchstart"==t.type){a.css("fill","cyan");let t=e[o],i=[{Country:[t.country,t.countryInfo.iso2]},{"New Confirmed":t.todayCases},{"Total Confirmed":t.cases},{"New Deaths":t.todayDeaths},{"Total Deaths":t.deaths},{"New Recovered":t.todayRecovered},{"Total Recovered":t.recovered},{Population:t.population}];$.each($info_box,e=>{let t=Object.keys(i[e])[0],a=Object.values(i[e])[0];0==e?$info_box.eq(e).html(`${a[0]} (${a[1]})`):$info_box.eq(e).html(`${t}: ${numberWithCommas(a)}`)})}else if("mousemove"==t.type||"touchmove"==t.type){let e=parseInt($info_box.parents("div").css("width")),a=parseInt($info_box.parents("div").css("height"));var i,n;"mousemove"==t.type?(i=t.pageX-e/2,n=t.pageY-a-10):(i=t.touches[0].pageX-e/2,n=t.touches[0].pageY-a-20),$info_box.parents("div").css({left:i,top:n}),$info_box.parents("div").show()}else $info_box.parents("div").hide(),statisticHeatMap(e);else $(this).hide()}),$(".options").find("input").on("click",()=>statisticHeatMap(e)),$continents.children().children("input[type='checkbox']").on("change",()=>displayContinents(e));var t="",a=[];$.each(e,(e,o)=>{t+=o.country+"%2C%20",a.push(o.country)}),$.ajax({type:"GET",url:"https://disease.sh/v3/covid-19/historical/"+t+"?lastdays=all",success:e=>plotHistory(e,a,!0)}),$.ajax({type:"GET",url:"https://disease.sh/v3/covid-19/historical/all?lastdays=all",success:e=>plotHistory(e,a,!1)})}$.ajax({type:"GET",url:"https://disease.sh/v3/covid-19/all?yesterday=false",success:e=>displayGlobalStatistics(e)}),$.ajax({type:"GET",url:"https://disease.sh/v3/covid-19/countries?yesterday=false",success:e=>displayStatsPerCountry(e)});for(var rect_colors=$("#colorbar").children(),i=0;i<=colors.length;i++)i<colors.length&&rect_colors.eq(i).css("background",colors[i]),rect_colors.eq(i).html("<p>"+text[i]+"</p>");var panZoom=svgPanZoom("#svg-map",pan_zoom_settings);$("#fit-screen").on("click",e=>{panZoom.reset()}),$("#zoom-in").on("click",e=>{let t=panZoom.getZoom();panZoom.zoom(1.2*t)}),$("#zoom-out").on("click",e=>{let t=panZoom.getZoom();panZoom.zoom(.8*t)});